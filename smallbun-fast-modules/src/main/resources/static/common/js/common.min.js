(function($){var $table=$(".table");$.extend({table:{_option:{},_params:{},init:function(options){$.table._option=options;$.table._params=$.common.isEmpty(options.queryParams)?$.table.queryParams:options.queryParams;var _sortOrder=$.common.isEmpty(options.sortOrder)?"asc":options.sortOrder;var _sortName=$.common.isEmpty(options.sortName)?"":options.sortName;$table.bootstrapTable({width:"auto",height:"auto",url:options.url,contentType:"application/x-www-form-urlencoded",method:"post",cache:false,sortable:true,sortStable:true,sortName:_sortName,sortOrder:_sortOrder,pagination:$.common.visible(options.pagination),clickToSelect:true,pageNumber:1,pageSize:20,pageList:[20,30,40],iconSize:"sm",sidePagination:"server",paginationLoop:false,cardView:true,toolbar:"#toolbar",search:$.common.visible(options.search),showRefresh:$.common.visible(options.showRefresh),showColumns:$.common.visible(options.showColumns),showToggle:$.common.visible(options.showToggle),showExport:$.common.visible(options.showExport),queryParams:$.table._params,columns:options.columns,responseHandler:$.table.responseHandler})},queryParams:function(params){return{size:params.limit,current:params.offset/params.limit+1,searchValue:params.search,orderByColumn:params.sort,isAsc:params.order}},responseHandler:function(res){if(res.status==="200"){return{rows:res.page.records,total:res.page.total}}else{$.modal.alert(res.status+":"+res.msg,modal_status.FAIL);return{rows:[],total:0}}},search:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var search={};$.each($("#"+currentId).serializeArray(),function(i,field){search[field.name]=field.value});$table.bootstrapTable("refresh",{query:search})},exportExcel:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var index=$.modal.loading("正在导出数据，请稍后...");$.post($.table._option.exportUrl,$("#"+currentId).serializeArray(),function(result){if(result.status===web_status.SUCCESS){window.location.href=contextPath+"fast/download?fileName="+result.msg+"&delete="+true}else{$.modal.alertError(result.msg)}$.modal.closeLoading(index)})},importExcel:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var index=$.modal.loading("正在导出数据，请稍后...");$.post($.table._option.exportUrl,$("#"+currentId).serializeArray(),function(result){if(result.status===web_status.SUCCESS){window.location.href=contextPath+"fast/download?fileName="+result.msg+"&delete="+true}else{$.modal.alertError(result.msg)}$.modal.closeLoading(index)})},refresh:function(){$table.bootstrapTable("refresh",{url:$.table._option.url,silent:true})},selectColumns:function(column){return $.map($table.bootstrapTable("getSelections"),function(row){return row[column]})},selectFirstColumns:function(){return $.map($table.bootstrapTable("getSelections"),function(row){return row[$.table._option.columns[1].field]})},selectDictLabel:function(_datas,_value){var actions=[];$.each(_datas,function(index,dict){if(dict.dictValue===_value){actions.push("<span class='badge badge-"+dict.listClass+"'>"+dict.dictLabel+"</span>");return false}});return actions.join("")},view:function(value,row,index){var actions=[];actions.push('<a  href="#" onclick="$.operate.view(\''+row.id+"','')\">"+value+"</a> ");return actions.join("")}},treeTable:{_option:{},_treeTable:{},init:function(options){$.table._option=options;$.treeTable._treeTable=$table.bootstrapTable({url:options.url,method:"post",singleSelect:true,striped:true,clickToSelect:true,toolbarAlign:"left",buttonsAlign:"left",width:"auto",height:"760",sidePagination:"server",idField:options.idField,rootParentId:options.rootParentId,parentIdField:options.parentIdField,columns:options.columns,treeShowField:options.treeShowField,responseHandler:$.treeTable.responseHandler,onLoadSuccess:function(res){$table.treegrid({initialState:"collapsed",treeColumn:1,expanderExpandedClass:"treegrid-expander glyphicon glyphicon-chevron-down",expanderCollapsedClass:"treegrid-expander glyphicon glyphicon-chevron-right",onChange:function(){$table.bootstrapTable("resetWidth")}})}})},search:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;var params={};$.each($("#"+currentId).serializeArray(),function(i,field){params[field.name]=field.value});$.treeTable._treeTable.bootstrapTable("refresh",params)},responseHandler:function(res){if(res.status==="900001"){$.modal.alert(res.status+":"+res.msg,modal_status.FAIL);return[]}else{return res.result}},refresh:function(){$.treeTable._treeTable.bootstrapTable("refresh")}},form:{reset:function(formId){var currentId=$.common.isEmpty(formId)?$("form").attr("id"):formId;$("#"+currentId)[0].reset()},selectCheckeds:function(name){var checkeds="";$('input:checkbox[name="'+name+'"]:checked').each(function(i){if("0"===i){checkeds=$(this).val()}else{checkeds+=(","+$(this).val())}});return checkeds},selectSelects:function(name){var selects="";$("#"+name+" option:selected").each(function(i){if("0"===i){selects=$(this).val()
        }else{selects+=(","+$(this).val())}});return selects}},modal:{icon:function(type){var icon="";if(type===modal_status.WARNING){icon=0}else{if(type===modal_status.SUCCESS){icon=1}else{if(type===modal_status.FAIL){icon=2}else{icon=3}}}return icon},msg:function(content,type){if(type!==undefined){layer.msg(content,{icon:$.modal.icon(type),time:1000,shift:5})}else{layer.msg(content)}},msgError:function(content){$.modal.msg(content,modal_status.FAIL)},msgSuccess:function(content){$.modal.msg(content,modal_status.SUCCESS)},msgWarning:function(content){$.modal.msg(content,modal_status.WARNING)},alert:function(content,type){layer.alert(content,{icon:$.modal.icon(type),title:"系统提示",btn:["确认"],btnclass:["btn btn-primary"],})},msgReload:function(msg,type){layer.msg(msg,{icon:$.modal.icon(type),time:500,shade:[0.1,"#8F8F8F"]},function(){$.modal.reload()})},alertError:function(content){$.modal.alert(content,modal_status.FAIL)},alertSuccess:function(content){$.modal.alert(content,modal_status.SUCCESS)},alertWarning:function(content){$.modal.alert(content,modal_status.WARNING)},close:function(){var index=parent.layer.getFrameIndex(window.name);parent.layer.close(index)},confirm:function(content,callBack){layer.confirm(content,{icon:3,title:"系统提示",btn:["确认","取消"],btnclass:["btn btn-primary","btn btn-danger"],},function(index){layer.close(index);callBack(true)})},open:function(title,url,width,height){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if($.common.isEmpty(title)){title=false}if($.common.isEmpty(url)){url="404.html"}if($.common.isEmpty(width)){width=1000}if($.common.isEmpty(height)){height=($(window).height()-45)}layer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url,btn:["确定","关闭"],yes:function(index,layero){var body=top.layer.getChildFrame("body",index);var iframeWin=layero.find("iframe")[0];iframeWin.contentWindow.doSubmit()},cancel:function(index){}})},view:function(title,url,width,height){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if($.common.isEmpty(title)){title=false}if($.common.isEmpty(url)){url="404.html"}if($.common.isEmpty(width)){width=1000}if($.common.isEmpty(height)){height=($(window).height()-50)}layer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url,btn:["关闭"],cancel:function(index){}})},openFull:function(title,url,width,height){if(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)){width="auto";height="auto"}if($.common.isEmpty(title)){title=false}if($.common.isEmpty(url)){url="404.html"}if($.common.isEmpty(width)){width=800}if($.common.isEmpty(height)){height=($(window).height()-50)}var index=layer.open({type:2,area:[width+"px",height+"px"],fix:false,maxmin:true,shade:0.3,title:title,content:url});layer.full(index)},loading:function(message){return layer.msg(message,{icon:16,shade:0.01,time:0})},closeLoading:function(index){setTimeout(function(){layer.close(index)},50)},reload:function(){parent.location.reload()}},operate:{submit:function(url,type,dataType,data){var index=$.modal.loading("正在处理中，请稍后...");var config={url:url,type:type,dataType:dataType,data:data,success:function(result){$.operate.ajaxSuccess(result,index)}};$.ajax(config)},post:function(url,data){$.operate.submit(url,"post","json",data)},remove:function(id){$.modal.confirm("确定删除该条"+$.table._option.modalName+"信息吗？",function(){var url=$.table._option.removeUrl;var data={"id":id};$.operate.submit(url,"post","json",data)})},batRemove:function(){var rows=$.common.isEmpty($.table._option.id)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.id);if(rows.length===0){$.modal.alertWarning("请至少选择一条记录");return}$.modal.confirm("确认要删除选中的"+rows.length+"条数据吗?",function(){var url=$.table._option.batRemoveUrl;var data={"ids":rows.join()};$.operate.submit(url,"post","json",data)})},add:function(id){var url=$.common.isEmpty(id)?$.table._option.createUrl:$.table._option.createUrl.replace("{id}",id);$.modal.open("添加"+$.table._option.modalName,url)},edit:function(id){var url="/404.html";if($.common.isNotEmpty(id)){url=$.table._option.updateUrl.replace("{id}","?id="+id)}else{id=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(id.length===0){$.modal.alertWarning("请至少选择一条记录");return}else{if(id.length>1){$.modal.alertWarning("只能选择一条数据");return}else{url=$.table._option.updateUrl.replace("{id}","?id="+id)}}}$.modal.open("修改"+$.table._option.modalName,url)},view:function(id,url){if($.common.isNotEmpty(id)){if($.common.isEmpty(url)){url=$.table._option.updateUrl.replace("{id}","?id="+id)}else{url=url+"?id="+id}}else{id=$.common.isEmpty($.table._option.uniqueId)?$.table.selectFirstColumns():$.table.selectColumns($.table._option.uniqueId);if(id.length===0){$.modal.alertWarning("请至少选择一条记录");return}else{if(id.length>1){$.modal.alertWarning("只能选择一条数据");return}else{if($.common.isEmpty(url)){url=$.table._option.updateUrl.replace("{id}","?id="+id)
        }else{url=url+"?id="+id}}}}$.modal.view("查看"+$.table._option.modalName,url)},addFull:function(id){var url=$.common.isEmpty(id)?$.table._option.createUrl:$.table._option.createUrl.replace("{id}",id);$.modal.openFull("添加"+$.table._option.modalName,url)},editFull:function(id){var url=$.table._option.updateUrl.replace("{id}",id);$.modal.openFull("修改"+$.table._option.modalName,url)},save:function(url,data){var index=$.modal.loading("正在处理中，请稍后...");var config={url:url,type:"post",dataType:"json",data:data,success:function(result){$.operate.saveSuccess(result,index)}};$.ajax(config)},ajaxSuccess:function(result,index){if(result.status===web_status.SUCCESS){$.modal.msgSuccess(result.msg);$.table.refresh()}else{$.modal.alertError(result.msg)}$.modal.closeLoading(index)},saveSuccess:function(result,index){if(result.status===web_status.SUCCESS){$.modal.msgReload("保存成功,正在刷新数据请稍后……",modal_status.SUCCESS)}else{$.modal.alertError(result.msg)}$.modal.closeLoading(index)},addTab:function(id,title,url){addTab({id:id,title:title,close:true,url:url})}},common:{parseParam:function(param,key){var paramStr="";if(param instanceof String||param instanceof Number||param instanceof Boolean){paramStr+="&"+key+"="+encodeURIComponent(param)}else{$.each(param,function(i){var k=key==null?i:key+(param instanceof Array?"["+i+"]":"."+i);paramStr+="&"+$.common.parseParam(this,k)})}return paramStr.substr(1)},isNotEmpty:function(value){return !$.common.isEmpty(value)},isEmpty:function(value){return value==null||this.trim(value)===""},visible:function(value){return !!($.common.isEmpty(value)||value===true)},trim:function(value){if(value==null){return""}return value.toString().replace(/(^\s*)|(\s*$)|\r|\n/g,"")},random:function(min,max){return Math.floor((Math.random()*max)+min)}},comboGrid:{init:function(options){$(options.comboGridId).combogrid({panelHeight:$.comboGrid.fixHeight(0.4),idField:options.idField,textField:options.textField,url:options.url,delay:$.common.isEmpty(options.delay)?500:options.delay,pageSize:$.common.isEmpty(options.pageSize)?10:options.pageSize,pageList:$.common.isEmpty(options.pageList)?10:[10,15,20,25,30],fitColumns:true,striped:true,editable:$.common.isEmpty(options.editable)?false:true,pagination:true,rownumbers:false,collapsible:false,fit:true,method:options.method,columns:options.columns,keyHandler:{up:function(){},down:function(){},enter:function(){},query:function(keyword){query(keyword);$(options.comboGridId).combogrid("setValue",keyword);$("#easyui-combogrid-id").val(keyword);$(options.valueId).val("")}},loader:loader,onSelect:function(){var selData=$(options.comboGridId).combogrid("grid").datagrid("getSelected");$("#easyui-combogrid-id").val(selData[""+options.idField+""]);$(options.valueId).val(selData.id);$(options.valueId+"-error").remove();$(".input-group.panel-noscroll.has-error").removeClass("has-error")}});var pager=$(options.comboGridId).combogrid("grid").datagrid("getPager");if(pager){$(pager).pagination({pageSize:options.pageSize,pageList:options.pageList,beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"共 {total} 条记录",onSelectPage:function(pageNumber,pageSize){getData(pageNumber,pageSize);$(options.comboGridId).combogrid("grid").datagrid("options").pageSize=pageSize;$(options.comboGridId).combogrid("setValue",$("#easyui-combogrid-id").val())},onChangePageSize:function(){},onRefresh:function(pageNumber,pageSize){getData(pageNumber,pageSize);$(options.comboGridId).combogrid("setValue",$("#easyui-combogrid-id").val())}})}var getData=function(current,size){$.ajax({type:options.method,url:options.url,data:{"current":current,"size":size},success:function(data){$(options.comboGridId).combogrid("grid").datagrid("loadData",buildData(data))}})};var query=function(data){var json={};json[""+options.textField+""]=data;$.ajax({type:options.method,url:options.url,data:json,dataType:"json",success:function(data){$(options.comboGridId).combogrid("grid").datagrid("loadData",buildData(data))}})};function loader(param,success,error){var that=$(this);var opts=that.datagrid("options");if(!opts.url){return false}var cache=that.data().datagrid.cache;var data={"current":opts.pageNumber,"size":opts.pageSize};if(!cache){$.ajax({type:opts.method,url:opts.url,data:data,dataType:"json",success:function(data){that.data().datagrid["cache"]=data;success(buildData(data))}})}else{success(buildData(cache))}function buildData(data){var temp=$.extend({},data);var tempRows=[];var start=(param.page-1)*parseInt(param.rows);var end=start+parseInt(param.rows);var rows=data.page.records;for(var i=start;i<end;i++){if(rows[i]){tempRows.push(rows[i])}else{break}}temp.rows=tempRows;temp.total=data.page.total;return temp}}var buildData=function(data){var temp=$.extend({});temp.rows=data.page.records;temp.total=data.page.total;return temp}},fixHeight:function(percent){return(document.body.clientHeight)*percent},fixWidth:function(percent){return(document.body.clientWidth-5)*percent}}})})(jQuery);web_status={SUCCESS:"200",FAIL:"500"};modal_status={SUCCESS:"success",FAIL:"error",WARNING:"warning"};