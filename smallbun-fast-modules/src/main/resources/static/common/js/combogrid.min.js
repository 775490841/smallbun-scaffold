$(function($){$.extend({combogrid:{init:function(options){$(options.comboGridId).combogrid({panelHeight:$.combogrid.fixHeight(0.4),idField:options.idField,textField:options.textField,url:options.url,delay:$.common.isEmpty(options.delay)?500:options.delay,pageSize:$.common.isEmpty(options.pageSize)?10:options.pageSize,pageList:$.common.isEmpty(options.pageList)?10:[10,15,20,25,30],fitColumns:true,striped:true,editable:$.common.isEmpty(options.editable)?false:true,pagination:true,rownumbers:false,collapsible:false,fit:true,method:options.method,columns:options.columns,keyHandler:{up:function(){},down:function(){},enter:function(){},query:function(keyword){query(keyword);$(options.comboGridId).combogrid("setValue",keyword);$("#easyui-combogrid-id").val(keyword);$(options.valueId).val("")}},loader:loader,onSelect:function(){var selData=$(options.comboGridId).combogrid("grid").datagrid("getSelected");$("#easyui-combogrid-id").val(selData[""+options.idField+""]);$(options.valueId).val(selData.id);$(options.valueId+"-error").remove();$(".input-group.panel-noscroll.has-error").removeClass("has-error")}});var pager=$(options.comboGridId).combogrid("grid").datagrid("getPager");if(pager){$(pager).pagination({pageSize:options.pageSize,pageList:options.pageList,beforePageText:"第",afterPageText:"页    共 {pages} 页",displayMsg:"共 {total} 条记录",onSelectPage:function(pageNumber,pageSize){getData(pageNumber,pageSize);$(options.comboGridId).combogrid("grid").datagrid("options").pageSize=pageSize;$(options.comboGridId).combogrid("setValue",$("#easyui-combogrid-id").val())},onChangePageSize:function(){},onRefresh:function(pageNumber,pageSize){getData(pageNumber,pageSize);$(options.comboGridId).combogrid("setValue",$("#easyui-combogrid-id").val())}})}var getData=function(current,size){$.ajax({type:options.method,url:options.url,data:{"current":current,"size":size},success:function(data){$(options.comboGridId).combogrid("grid").datagrid("loadData",buildData(data))}})};var query=function(data){var json={};json[""+options.textField+""]=data;$.ajax({type:options.method,url:options.url,data:json,dataType:"json",success:function(data){$(options.comboGridId).combogrid("grid").datagrid("loadData",buildData(data))}})};function loader(param,success,error){var that=$(this);var opts=that.datagrid("options");if(!opts.url){return false}var cache=that.data().datagrid.cache;var data={"current":opts.pageNumber,"size":opts.pageSize};if(!cache){$.ajax({type:opts.method,url:opts.url,data:data,dataType:"json",success:function(data){that.data().datagrid["cache"]=data;success(buildData(data))}})}else{success(buildData(cache))}function buildData(data){var temp=$.extend({},data);var tempRows=[];var start=(param.page-1)*parseInt(param.rows);var end=start+parseInt(param.rows);var rows=data.page.records;for(var i=start;i<end;i++){if(rows[i]){tempRows.push(rows[i])}else{break}}temp.rows=tempRows;temp.total=data.page.total;return temp}}var buildData=function(data){var temp=$.extend({});temp.rows=data.page.records;temp.total=data.page.total;return temp}},fixHeight:function(percent){return(document.body.clientHeight)*percent},fixWidth:function(percent){return(document.body.clientWidth-5)*percent}}})});